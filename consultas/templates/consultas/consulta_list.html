{% extends 'base.html' %}
{% load static %}

{% block title %}Relatórios de Consultas{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-11">
      <div class="card shadow-lg rounded-3">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h2 class="mb-0">Relatórios de Consultas</h2>
          <a href="{% url 'consulta_nova' %}" class="btn btn-light btn-sm fw-bold">
            + Nova Consulta
          </a>
        </div>
        <div class="card-body">

          <!-- Form de Filtros -->
          <form method="get" class="row g-3 mb-4">
            <div class="col-md-3">
              <label for="data_inicio" class="form-label">Data Início:</label>
              <input type="date" class="form-control" name="data_inicio" id="data_inicio" value="{{ data_inicio }}">
            </div>
            <div class="col-md-3">
              <label for="data_fim" class="form-label">Data Fim:</label>
              <input type="date" class="form-control" name="data_fim" id="data_fim" value="{{ data_fim }}">
            </div>
            <div class="col-md-3">
              <label for="situacao" class="form-label">Situação:</label>
              <select class="form-select" name="situacao" id="situacao">
                <option {% if situacao == 'Todos' %}selected{% endif %}>Todos</option>
                <option {% if situacao == 'Em aberto' %}selected{% endif %}>Em aberto</option>
                <option {% if situacao == 'Finalizada' %}selected{% endif %}>Finalizada</option>
              </select>
            </div>

            {% comment %} <div class="col-md-3">
              <label for="tipo_consulta" class="form-label">Tipo de Consulta:</label>
              <select class="form-select" name="tipo_consulta" id="tipo_consulta">
                <option {% if tipo_consulta == 'Todos' %}selected{% endif %}>Todos</option>
                <option {% if tipo_consulta == 'Unimed' %}selected{% endif %}>Unimed</option>
                <option {% if tipo_consulta == 'Particular' %}selected{% endif %}>Particular</option>
                <option {% if tipo_consulta == 'Pladisa' %}selected{% endif %}>Pladisa</option>
              </select> {% endcomment %}
          

            <div class="col-md-3 align-self-end">
              <button type="submit" class="btn btn-primary w-100">Filtrar</button>
            </div>
          </form>

          <!-- Tabela -->
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Nome do Paciente</th>
                  <th>Data da Consulta</th>
                  <th>Valor</th>
                  <th>Situação</th>
                </tr>
              </thead>
              <tbody>
                {% for c in consultas %}
                <tr>
                  <td>{{ c.paciente.nome }}</td>
                  <td>{{ c.data_consulta|date:"d/m/Y" }}</td>
                  <td>R$ {{ c.valor_consulta }}</td>
                  <td>
                    {% if c.situacao == "Finalizada" %}
                      <span class="badge bg-success">{{ c.situacao }}</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">{{ c.situacao }}</span>
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center text-muted">Nenhuma consulta encontrada.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Totalizador -->
          <div class="alert alert-info mt-3">
            <strong>Totalizado:</strong> R$ {{ total_valor }}
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
